<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solidsteel | Sistema de Preços</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/papaparse/5.3.0/papaparse.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-slate-100 text-slate-900">

    <header class="bg-[#004a44] text-white p-4 shadow-md sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="font-bold uppercase tracking-widest">Solidsteel 2026</h1>
            <div id="statusBadge" class="text-[10px] px-2 py-1 rounded bg-yellow-500 text-black font-bold">CONECTANDO...</div>
        </div>
    </header>

    <main class="container mx-auto p-4">
        <div id="debugScreen" class="py-10 text-center">
            <div id="spinner" class="animate-spin inline-block w-8 h-8 border-4 border-[#004a44] border-t-transparent rounded-full mb-4"></div>
            <p id="debugMsg" class="text-slate-500 text-sm">Iniciando leitura do Google Sheets...</p>
        </div>

        <div id="filterBar" class="hidden mb-6">
            <input type="text" id="searchInput" placeholder="Digite o modelo (ex: Ssae 5L)..." 
                class="w-full p-4 rounded-xl border-none shadow-sm focus:ring-2 focus:ring-[#004a44] outline-none">
        </div>

        <div id="tableWrapper" class="hidden bg-white rounded-xl shadow-lg overflow-hidden">
            <table class="w-full text-left border-collapse">
                <thead class="bg-slate-50 border-b">
                    <tr>
                        <th class="p-4 text-xs font-bold text-slate-500 uppercase">Produto</th>
                        <th class="p-4 text-xs font-bold text-slate-500 uppercase">Specs</th>
                        <th class="p-4 text-xs font-bold text-slate-500 uppercase text-right">À Vista</th>
                        <th class="p-4 text-xs font-bold text-slate-500 uppercase text-center">Zap</th>
                    </tr>
                </thead>
                <tbody id="tableBody" class="divide-y divide-slate-100"></tbody>
            </table>
        </div>
    </main>

    <script>
        const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQbfeK3jfA6nWF0e7t9lKWsVnmTes5SM0Jsg3_bSls4Zd6rtAtw6Ba5kE4FOPXwzxB0NM-sl4DQmsid/pub?gid=0&single=true&output=csv';

        function log(msg, isError = false) {
            const el = document.getElementById('debugMsg');
            el.textContent = msg;
            if(isError) el.classList.add('text-red-600');
            console.log(msg);
        }

        function init() {
            log("Buscando CSV no Google...");
            
            Papa.parse(CSV_URL, {
                download: true,
                header: false, // Usando falso para ignorar cabeçalhos problemáticos
                skipEmptyLines: true,
                complete: function(results) {
                    log("Dados recebidos! Processando...");
                    if(results.data.length > 0) {
                        organizarDados(results.data);
                    } else {
                        log("Erro: O arquivo parece estar vazio.", true);
                    }
                },
                error: function(err) {
                    log("Erro crítico de conexão: " + err, true);
                    document.getElementById('statusBadge').className = "text-[10px] px-2 py-1 rounded bg-red-600 text-white font-bold";
                    document.getElementById('statusBadge').textContent = "ERRO DE LINK";
                }
            });
        }

        let listaProdutos = [];

        function organizarDados(rows) {
            try {
                // Pulamos a primeira linha (cabeçalho) e mapeamos as colunas baseadas no seu print
                listaProdutos = rows.slice(1).map(row => ({
                    categoria: row[0] || '',
                    modelo: row[1] || '',
                    // Junta as especificações das colunas C, D, E e F
                    especs: [row[2], row[3], row[4], row[5]].filter(x => x && x.trim() !== "").join(' | '),
                    vista: row[6] || '0,00',
                    faturado: row[7] || '0,00'
                })).filter(p => p.modelo !== ''); // Remove linhas vazias

                document.getElementById('debugScreen').classList.add('hidden');
                document.getElementById('filterBar').classList.remove('hidden');
                document.getElementById('tableWrapper').classList.remove('hidden');
                document.getElementById('statusBadge').className = "text-[10px] px-2 py-1 rounded bg-emerald-500 text-white font-bold";
                document.getElementById('statusBadge').textContent = "ONLINE";

                renderTable(listaProdutos);
            } catch (e) {
                log("Erro ao processar linhas: " + e.message, true);
            }
        }

        function renderTable(dados) {
            const container = document.getElementById('tableBody');
            container.innerHTML = dados.map(p => `
                <tr class="hover:bg-slate-50 transition-colors">
                    <td class="p-4">
                        <div class="font-bold text-[#004a44]">${p.modelo}</div>
                        <div class="text-[10px] text-slate-400 uppercase">${p.categoria}</div>
                    </td>
                    <td class="p-4 text-xs text-slate-600">${p.especs}</td>
                    <td class="p-4 text-right font-mono font-bold text-emerald-600">R$ ${p.vista}</td>
                    <td class="p-4 text-center">
                        <button onclick="mandarZap('${p.modelo}', '${p.vista}')" class="text-emerald-500 text-lg hover:scale-125 transition-transform">
                            <i class="fab fa-whatsapp"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function mandarZap(m, p) {
            const msg = encodeURIComponent(`Olá, segue cotação:\n*${m}*\nPreço: R$ ${p}`);
            window.open(`https://wa.me/?text=${msg}`, '_blank');
        }

        document.getElementById('searchInput').addEventListener('input', (e) => {
            const busca = e.target.value.toLowerCase();
            const filtrados = listaProdutos.filter(p => 
                (p.modelo + p.especs + p.categoria).toLowerCase().includes(busca)
            );
            renderTable(filtrados);
        });

        init();
    </script>
</body>
</html>
